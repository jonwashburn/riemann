name: Lean Build

on:
  push:
    branches: [ main ]
    tags: [ '*' ]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install elan
        run: |
          set -eux
          curl -L https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -o elan-init.sh
          bash elan-init.sh -y --default-toolchain leanprover/lean4:v4.13.0
          echo "$HOME/.elan/bin" >> "$GITHUB_PATH"
      - name: Cache Lake
        uses: actions/cache@v4
        with:
          path: |
            ~/.lake
            ./.lake
          key: ${{ runner.os }}-lake-${{ hashFiles('**/lake-manifest.json') }}
      - name: Build RH proof
        run: |
          cd no-zeros
          lake build rh.Proof.Main
      - name: Check no sorries or local axioms
        run: |
          ! grep -R "sorry" -n no-zeros/rh || (echo "found sorry" && exit 1)
          ! grep -R "^axiom " -n no-zeros/rh || (echo "found local axiom" && exit 1)
